# BUG 追踪记录

## 📋 BUG编号规则
- **APP-X**: 应用级别BUG
- **GAME-X**: 游戏逻辑BUG
- **UI-X**: UI显示BUG
- **PERF-X**: 性能问题

---

## ✅ 已修复 BUG

### APP-1: Firebase初始化失败
**发现时间**: 2026-01-26
**状态**: ✅ 已修复
**严重程度**: 高

**描述**:
Firebase初始化时报错，导致应用无法连接到后端。

**原因**:
- google-services.json配置错误
- Gradle依赖版本不匹配

**解决方案**:
1. 重新下载正确的google-services.json
2. 更新Gradle依赖到兼容版本
3. 添加初始化错误处理和离线模式降级

**修复文件**:
- `android/app/google-services.json`
- `android/app/build.gradle`
- `src/services/FirebaseService.ts`

---

### APP-2: 模拟器网络连接问题
**发现时间**: 2026-01-26
**状态**: ✅ 已修复
**严重程度**: 中

**描述**:
Android模拟器无法连接到Firebase，导致离线模式

**原因**:
- 模拟器没有Google Play服务
- 网络配置问题

**解决方案**:
1. 使用带Google Play的模拟器镜像
2. 配置模拟器DNS
3. 添加网络状态检测和提示

**修复文件**:
- 文档: `FIX_EMULATOR_NETWORK.md`

---

### APP-3: 昵称修改时间限制计算错误
**发现时间**: 2026-01-26
**状态**: ✅ 已修复
**严重程度**: 低

**描述**:
昵称修改30天限制计算不准确，用户可能过早修改昵称

**原因**:
时间戳计算逻辑错误

**解决方案**:
修复时间差计算：`(now - lastChange) / (1000 * 60 * 60 * 24) >= 30`

**修复文件**:
- `src/services/AuthService.ts`
- `src/screens/ProfileScreen.tsx`

---

### APP-4: 游戏历史保存时丢失棋盘数据
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 中

**描述**:
游戏结束后保存的历史记录缺少棋盘快照数据

**原因**:
保存时没有正确序列化棋盘状态

**解决方案**:
添加完整的棋盘数据保存：
- airplanes positions
- attack history
- player/AI stats

**修复文件**:
- `src/screens/GameScreen.tsx`
- `src/services/StatisticsService.ts`

---

### GAME-5: AI超时攻击导致游戏卡住
**发现时间**: 2026-01-25
**状态**: ✅ 已修复
**严重程度**: 高

**描述**:
Hard AI在某些情况下超时，导致游戏无法继续

**原因**:
AIStrategyUltraV2的搜索算法复杂度过高

**解决方案**:
添加搜索超时限制和降级策略

**修复文件**:
- `src/ai/AIStrategyUltraV2.ts`

---

### UI-6: 成就解锁通知样式问题
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 低

**描述**:
成就解锁Alert显示时格式不美观

**原因**:
多个成就同时解锁时文本拼接问题

**解决方案**:
改进Alert内容格式，添加图标和换行

**修复文件**:
- `src/screens/GameScreen.tsx`

---

### PERF-7: 游戏历史列表加载慢
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 中

**描述**:
游戏历史超过50条后，列表加载明显卡顿

**原因**:
一次性加载所有历史记录

**解决方案**:
1. 限制默认加载数量（20条）
2. 实现分页加载
3. 添加加载指示器

**修复文件**:
- `src/screens/GameHistoryScreen.tsx`

---

### APP-8: 音频初始化警告
**发现时间**: 2026-01-28
**状态**: ✅ 已修复
**严重程度**: 低

**描述**:
控制台出现音频初始化警告

**原因**:
react-native-sound在某些设备上的兼容性问题

**解决方案**:
添加try-catch错误处理和降级逻辑

**修复文件**:
- `src/services/AudioManager.ts`

---

### UI-9: 皮肤预览不准确
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 低

**描述**:
皮肤选择页面的预览颜色与实际游戏中显示不一致

**原因**:
预览组件使用了不同的颜色值

**解决方案**:
统一使用SkinConfig中的颜色定义

**修复文件**:
- `src/screens/SkinsScreen.tsx`

---

### APP-10: 统计数据同步延迟
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 中

**描述**:
游戏结束后，统计数据更新有延迟

**原因**:
Firestore写入是异步的，UI没有等待完成

**解决方案**:
添加加载状态和更新完成回调

**修复文件**:
- `src/services/StatisticsService.ts`
- `src/screens/ProfileScreen.tsx`

---

### GAME-11: 投降时成就检查缺失
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 中

**描述**:
玩家投降时没有触发成就检查，导致某些成就无法解锁

**原因**:
投降逻辑中漏掉了checkAchievements调用

**解决方案**:
在投降处理中添加成就检查

**修复文件**:
- `src/screens/GameScreen.tsx`

---

### APP-12: AchievementService初始化时机错误
**发现时间**: 2026-01-29
**状态**: ✅ 已修复
**严重程度**: 低

**描述**:
AchievementService在GameScreen中首次调用时可能未初始化

**原因**:
App.tsx的初始化是异步的，GameScreen可能先执行

**解决方案**:
在checkAchievements中添加初始化检查

**修复文件**:
- `src/services/AchievementService.ts`

---

## 🔄 待修复 BUG

### UI-13: 长昵称显示溢出
**发现时间**: 2026-01-29
**状态**: 🔄 待修复
**严重程度**: 低

**描述**:
昵称过长时在某些UI中显示溢出

**复现步骤**:
1. 设置一个20字符的昵称
2. 查看排行榜或游戏历史
3. 昵称显示不完整

**临时方案**:
限制昵称显示长度

**计划修复**: Phase 7

---

### PERF-14: 排行榜数据缓存失效
**发现时间**: 2026-01-29
**状态**: 🔄 待修复
**严重程度**: 低

**描述**:
排行榜缓存在某些情况下不生效

**原因分析**:
缓存键可能不唯一

**计划修复**: Phase 7

---

## 🐛 已知限制

### 限制-1: iOS未测试
**类型**: 平台限制
**描述**: 当前仅在Android上测试，iOS功能未验证

**影响**:
- iOS构建可能失败
- iOS特定功能可能不工作

**计划**: 后续添加iOS测试

---

### 限制-2: 离线模式功能受限
**类型**: 功能限制
**描述**: 离线模式下某些功能不可用

**影响**:
- 无法同步到云端
- 无法查看排行榜
- 无法进行在线对战

**说明**: 这是设计上的限制，非BUG

---

### 限制-3: 回放系统未实现
**类型**: 功能缺失
**描述**: 当前无法回放历史游戏

**影响**:
- 无法复盘学习
- 战报只能查看静态数据

**计划**: Phase 7实现

---

## 📊 BUG统计

**总计**: 14个
- ✅ 已修复: 12个
- 🔄 待修复: 2个
- 📋 已知限制: 3个

**按严重程度**:
- 🔴 高: 2个（全部已修复）
- 🟡 中: 6个（5个已修复，1个待修复）
- 🟢 低: 6个（5个已修复，1个待修复）

**按类型**:
- APP级: 8个
- GAME级: 2个
- UI级: 3个
- PERF级: 2个

---

## 🔍 BUG报告模板

```markdown
### BUG-ID: 标题
**发现时间**: YYYY-MM-DD
**状态**: 🔄 待修复 / ✅ 已修复
**严重程度**: 高/中/低

**描述**:
详细描述BUG现象

**复现步骤**:
1. 步骤1
2. 步骤2
3. 观察结果

**预期行为**:
应该如何

**实际行为**:
实际如何

**环境**:
- 设备:
- Android版本:
- 应用版本:

**原因分析**:
（可选）

**解决方案**:
（修复后填写）

**修复文件**:
（修复后填写）
```

---

**维护者**: Claude Sonnet 4.5
**最后更新**: 2026-01-29
